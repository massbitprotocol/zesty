version: "3"
networks:
  mbr_test_network_1:
    driver: bridge

services:
  mbr_gateway:
    privileged: true
    restart: unless-stopped
    image: openresty/openresty:1.19.9.1-14-focal
    # image: massbit/massbitroute_zesty:v0.0.1-dev
    container_name: mbr_gateway
    networks:
      - mbr_test_network_1
    ports:
      - 80:80
    volumes:
       - ./nginx/conf/nginx.conf:/usr/local/openresty/nginx/conf/nginx.conf
       - ./nginx/conf:/usr/local/openresty/nginx/conf/extensions:rw
       - ./nginx/modules:/usr/local/openresty/nginx/modules/extensions:rw
       - ./nginx/luascripts:/usr/local/openresty/lualib/mbr:rw
       - ./volume/data:/usr/local/openresty/nginx/data:rw
       - ./volume/logs:/usr/local/openresty/nginx/logs:rw
       
# Minh testing working running conf
       - ./volume/mbr:/.mbr:rw
    environment:
      - MBR_ENV=keiko
      - ID=
      - USER_ID=
      - BLOCKCHAIN=
      - NETWORK=
      - ZONE=
      - APP_KEY=
      - INSTALL_CMD=

  prometheus:
    image: prom/prometheus
    container_name: prometheus
    networks:
      - mbr_test_network_1
    volumes:
      - ./prometheus/config.yml:/etc/prometheus/prometheus.yml
    ports:
      - "9090:9090"
