upstream upstream_datasources {
    server unix:/tmp/mbr_datasources.sock max_fails=1 fail_timeout=3s ;
    keepalive 100;
}
server {
    listen unix:/tmp/mbr_datasources.sock;
    location / {
        resolver 8.8.8.8;
        default_type 'application/json';   
        #set_datasourcev1 $proxy; 
        #set $proxy "https://mainnet.infura.io/v3/ada4a958376749a9bbd6abc0fc5f404b";
        set_by_zesty2 $proxy $reqid;
        set $api_method "";
        access_by_lua_block {
            local main = require('mbr/main')
            main.parse_rpc_body()
        }
        vhost_traffic_status_filter_by_set_key $api_method type::node::uri::/v1$request_uri::reqid::$reqid;
        proxy_pass $proxy;
    }
}