nginx: the configuration file /massbit/massbitroute/app/src/sites/services/gateway/tmp/nginx.conf syntax is ok
nginx: configuration file /massbit/massbitroute/app/src/sites/services/gateway/tmp/nginx.conf test is successful
# configuration file /massbit/massbitroute/app/src/sites/services/gateway/tmp/nginx.conf:
      load_module /massbit/massbitroute/app/src/sites/services/gateway/bin/openresty/nginx/modules/ngx_http_link_func_module.so;
      load_module /massbit/massbitroute/app/src/sites/services/gateway/bin/openresty/nginx/modules/ngx_http_geoip2_module.so;
      load_module /massbit/massbitroute/app/src/sites/services/gateway/bin/openresty/nginx/modules/ngx_stream_geoip2_module.so;
      load_module /massbit/massbitroute/app/src/sites/services/gateway/bin/openresty/nginx/modules/ngx_http_vhost_traffic_status_module.so;
      load_module /massbit/massbitroute/app/src/sites/services/gateway/bin/openresty/nginx/modules/ngx_http_stream_server_traffic_status_module.so;
      load_module /massbit/massbitroute/app/src/sites/services/gateway/bin/openresty/nginx/modules/ngx_stream_server_traffic_status_module.so;

daemon off; # control by supervisord
user root;
worker_processes auto;
error_log /massbit/massbitroute/app/src/sites/services/gateway/logs/nginx/nginx-error.log;
pid /massbit/massbitroute/app/src/sites/services/gateway/tmp/nginx.pid;
events {
    worker_connections 1024;
}
            env BIND_ADDRESS;


#_INCLUDE_SITES_MAININIT_
http {
    server_tokens off;
    map_hash_max_size 128;
    map_hash_bucket_size 128;
    server_names_hash_bucket_size 128;
    include /massbit/massbitroute/app/src/sites/services/gateway/bin/openresty/nginx/conf/mime.types;
    access_log /massbit/massbitroute/app/src/sites/services/gateway/logs/nginx/nginx-access.log;
    # tmp
    client_body_temp_path /massbit/massbitroute/app/src/sites/services/gateway/tmp/client_body_temp;
    fastcgi_temp_path /massbit/massbitroute/app/src/sites/services/gateway/tmp/fastcgi_temp;
    proxy_temp_path /massbit/massbitroute/app/src/sites/services/gateway/tmp/proxy_temp;
    scgi_temp_path /massbit/massbitroute/app/src/sites/services/gateway/tmp/scgi_temp;
    uwsgi_temp_path /massbit/massbitroute/app/src/sites/services/gateway/tmp/uwsgi_temp;
    lua_package_path '/massbit/massbitroute/app/src/sites/services/gateway/gbc/src/?.lua;/massbit/massbitroute/app/src/sites/services/gateway/lib/?.lua;/massbit/massbitroute/app/src/sites/services/gateway/src/?.lua;/massbit/massbitroute/app/src/sites/services/gateway/sites/../src/?.lua/massbit/massbitroute/app/src/sites/services/gateway/sites/../lib/?.lua;/massbit/massbitroute/app/src/sites/services/gateway/sites/../src/?.lua;/massbit/massbitroute/app/src/sites/services/gateway/bin/openresty/site/lualib/?.lua;;';
    lua_package_cpath '/massbit/massbitroute/app/src/sites/services/gateway/gbc/src/?.so;/massbit/massbitroute/app/src/sites/services/gateway/lib/?.so;/massbit/massbitroute/app/src/sites/services/gateway/src/?.so;/massbit/massbitroute/app/src/sites/services/gateway/sites/../src/?.so/massbit/massbitroute/app/src/sites/services/gateway/sites/../lib/?.so;/massbit/massbitroute/app/src/sites/services/gateway/sites/../src/?.so;/massbit/massbitroute/app/src/sites/services/gateway/bin/openresty/site/lualib/?.so;;';
            resolver 8.8.8.8 ipv6=off;
            variables_hash_bucket_size 512;
            server_names_hash_max_size 1024;
            #ssl
            lua_shared_dict auto_ssl 1m;
            lua_shared_dict auto_ssl_settings 64k;

            #lua
            lua_capture_error_log 32m;
            #lua_need_request_body on;
            lua_regex_match_limit 1500;
            lua_check_client_abort on;
            lua_socket_log_errors off;
            lua_shared_dict _GBC_ 1024k;
            lua_code_cache on;


#_INCLUDE_SITES_HTTPINIT_
    init_by_lua '\n
	   require("framework.init")
	   local appKeys = dofile("/massbit/massbitroute/app/src/sites/services/gateway/tmp/app_keys.lua")
	   local globalConfig = dofile("/massbit/massbitroute/app/src/sites/services/gateway/tmp/config.lua")
	   cc.DEBUG = globalConfig.DEBUG
	   local gbc = cc.import("#gbc")
	   cc.exports.nginxBootstrap = gbc.NginxBootstrap:new(appKeys, globalConfig)


--_INCLUDE_SITES_LUAINIT_\n    ';
    init_worker_by_lua '\n



--_INCLUDE_SITES_LUAWINIT_\n    ';
        include /massbit/massbitroute/app/src/sites/services/gateway/tmp/site_http_gateway.conf;
}
# rtmp_auto_push on;
# rtmp_auto_push_reconnect 1s;
# rtmp_socket_dir /massbit/massbitroute/app/src/sites/services/gateway/tmp;
# rtmp {
#     #_INCLUDE_RTMPS_ENTRY_
# }
stream {
        include /massbit/massbitroute/app/src/sites/services/gateway/tmp/site_stream_gateway.conf;
}

# configuration file /massbit/massbitroute/app/src/sites/services/gateway/bin/openresty/nginx/conf/mime.types:

types {
    text/html                                        html htm shtml;
    text/css                                         css;
    text/xml                                         xml;
    image/gif                                        gif;
    image/jpeg                                       jpeg jpg;
    application/javascript                           js;
    application/atom+xml                             atom;
    application/rss+xml                              rss;

    text/mathml                                      mml;
    text/plain                                       txt;
    text/vnd.sun.j2me.app-descriptor                 jad;
    text/vnd.wap.wml                                 wml;
    text/x-component                                 htc;

    image/png                                        png;
    image/svg+xml                                    svg svgz;
    image/tiff                                       tif tiff;
    image/vnd.wap.wbmp                               wbmp;
    image/webp                                       webp;
    image/x-icon                                     ico;
    image/x-jng                                      jng;
    image/x-ms-bmp                                   bmp;

    font/woff                                        woff;
    font/woff2                                       woff2;

    application/java-archive                         jar war ear;
    application/json                                 json;
    application/mac-binhex40                         hqx;
    application/msword                               doc;
    application/pdf                                  pdf;
    application/postscript                           ps eps ai;
    application/rtf                                  rtf;
    application/vnd.apple.mpegurl                    m3u8;
    application/vnd.google-earth.kml+xml             kml;
    application/vnd.google-earth.kmz                 kmz;
    application/vnd.ms-excel                         xls;
    application/vnd.ms-fontobject                    eot;
    application/vnd.ms-powerpoint                    ppt;
    application/vnd.oasis.opendocument.graphics      odg;
    application/vnd.oasis.opendocument.presentation  odp;
    application/vnd.oasis.opendocument.spreadsheet   ods;
    application/vnd.oasis.opendocument.text          odt;
    application/vnd.openxmlformats-officedocument.presentationml.presentation
                                                     pptx;
    application/vnd.openxmlformats-officedocument.spreadsheetml.sheet
                                                     xlsx;
    application/vnd.openxmlformats-officedocument.wordprocessingml.document
                                                     docx;
    application/vnd.wap.wmlc                         wmlc;
    application/x-7z-compressed                      7z;
    application/x-cocoa                              cco;
    application/x-java-archive-diff                  jardiff;
    application/x-java-jnlp-file                     jnlp;
    application/x-makeself                           run;
    application/x-perl                               pl pm;
    application/x-pilot                              prc pdb;
    application/x-rar-compressed                     rar;
    application/x-redhat-package-manager             rpm;
    application/x-sea                                sea;
    application/x-shockwave-flash                    swf;
    application/x-stuffit                            sit;
    application/x-tcl                                tcl tk;
    application/x-x509-ca-cert                       der pem crt;
    application/x-xpinstall                          xpi;
    application/xhtml+xml                            xhtml;
    application/xspf+xml                             xspf;
    application/zip                                  zip;

    application/octet-stream                         bin exe dll;
    application/octet-stream                         deb;
    application/octet-stream                         dmg;
    application/octet-stream                         iso img;
    application/octet-stream                         msi msp msm;

    audio/midi                                       mid midi kar;
    audio/mpeg                                       mp3;
    audio/ogg                                        ogg;
    audio/x-m4a                                      m4a;
    audio/x-realaudio                                ra;

    video/3gpp                                       3gpp 3gp;
    video/mp2t                                       ts;
    video/mp4                                        mp4;
    video/mpeg                                       mpeg mpg;
    video/quicktime                                  mov;
    video/webm                                       webm;
    video/x-flv                                      flv;
    video/x-m4v                                      m4v;
    video/x-mng                                      mng;
    video/x-ms-asf                                   asx asf;
    video/x-ms-wmv                                   wmv;
    video/x-msvideo                                  avi;
}

# configuration file /massbit/massbitroute/app/src/sites/services/gateway/tmp/site_http_gateway.conf:
proxy_cache_path /massbit/massbitroute/app/src/sites/services/gateway/cache_gateway levels=1:2 keys_zone=cache_gateway:100m inactive=24h max_size=1g;
map $http_upgrade $connection_upgrade {
    default upgrade;
    '' close;
}


map $host $resp_body {
default '';
}

vhost_traffic_status_zone shared:vhost_traffic_status:32m;
vhost_traffic_status_dump /massbit/massbitroute/app/src/sites/services/gateway/data/vts_gw.db;
log_format main_json escape=json '{' '"msec": "$msec", ' '"connection": "$connection", ' '"connection_requests": "$connection_requests", ' '"pid": "$pid", ' '"request_id": "$request_id", ' '"request_length": "$request_length", ' '"remote_addr": "$remote_addr", ' '"remote_user": "$remote_user", ' '"remote_port": "$remote_port", ' '"time_local": "$time_local", ' '"time_iso8601": "$time_iso8601", ' '"request": "$request", ' '"request_uri": "$request_uri", ' '"args": "$args", ' '"status": "$status", ' '"body_bytes_sent": "$body_bytes_sent", ' '"bytes_sent": "$bytes_sent", ' '"http_referer": "$http_referer", ' '"http_user_agent": "$http_user_agent", ' '"http_x_forwarded_for": "$http_x_forwarded_for", ' '"http_host": "$http_host", ' '"server_name": "$server_name", ' '"request_time": "$request_time", ' '"upstream": "$upstream_addr", ' '"upstream_connect_time": "$upstream_connect_time", ' '"upstream_header_time": "$upstream_header_time", ' '"upstream_response_time": "$upstream_response_time", ' '"upstream_response_length": "$upstream_response_length", ' '"upstream_cache_status": "$upstream_cache_status", ' '"ssl_protocol": "$ssl_protocol", ' '"ssl_cipher": "$ssl_cipher", ' '"scheme": "$scheme", ' '"request_method": "$request_method", ' '"server_protocol": "$server_protocol", ' '"pipe": "$pipe", ' '"gzip_ratio": "$gzip_ratio", ' '"request_body": "$request_body", ' '"response_body": "$resp_body", ' '"http_cf_ray": "$http_cf_ray", ' '"real_ip": "$http_x_forwarded_for",' '"tcpinfo_rtt": "$tcpinfo_rtt",' '"tcpinfo_rttvar": "$tcpinfo_rttvar"' '}';
include /massbit/massbitroute/app/src/sites/services/gateway/sites/../etc/_geoip.conf;
include /massbit/massbitroute/app/src/sites/services/gateway/sites/../http.d/*.conf0;
include /massbit/massbitroute/app/src/sites/services/gateway/sites/../http.d/*.conf;
include /massbit/massbitroute/app/src/sites/services/gateway/sites/../http.d/*.conf9;

# configuration file /massbit/massbitroute/app/src/sites/services/gateway/sites/../etc/_geoip.conf:
map $http_x_forwarded_for $realip {
    ~^(\d+\.\d+\.\d+\.\d+) $1; # IPv4
    ~*([A-F0-9:]*) $1; # Very relaxed IPv6 regex
    default $remote_addr;
}
geoip2 /massbit/massbitroute/app/src/sites/services/gateway/data/geoip/GeoIP2-City.mmdb {
    auto_reload 60m;
    $db_timestamp metadata build_epoch;
    $db_last_check metadata last_check;
    $db_last_change metadata last_change;
    $continent_id source=$realip continent geoname_id;
    $continent_code source=$realip continent code;
    $continent_name source=$realip continent names en;
    $country_id source=$realip country geoname_id;
    $country_code source=$realip country iso_code;
    $country_name source=$realip country names en;
    $city_id source=$realip city geoname_id;
    $city_name source=$realip city names en;
    $location_acc source=$realip location accuracy_radius;
    $location_lat source=$realip location latitude;
    $location_lon source=$realip location longitude;
    $location_timezone source=$realip location time_zone;
}

# configuration file /massbit/massbitroute/app/src/sites/services/gateway/sites/../http.d/gateway.conf0:
server {
    listen 80;
    include /massbit/massbitroute/app/src/sites/services/gateway/etc/_ssl_gw.mbr.massbitroute.conf;
    server_name _;
    location /_rtt {
        echo $tcpinfo_rtt;
    }
    location /_ping {
        return 200 pong;
    }
    location /__data {
        autoindex on;
        alias /massbit/massbitroute/app/src/sites/services/gateway/data;
    }
    location /__log {
        autoindex on;
        alias /massbit/massbitroute/app/src/sites/services/gateway/logs;
    }
    location /__vars {
        autoindex on;
        alias /massbit/massbitroute/app/src/sites/services/gateway/vars;
    }
    location /__conf {
        autoindex on;
        alias /massbit/massbitroute/app/src/sites/services/gateway/http.d;
    }
    location /__worker/ {
        proxy_pass http://127.0.0.1:4040/;
    }
    location /__internal_status_vhost/ {
        include /massbit/massbitroute/app/src/sites/services/gateway/etc/_vts_server.conf;
    }
    # location /__cmd {
    #     default_type application/json;
    #     content_by_lua_file /massbit/massbitroute/app/src/sites/services/gateway/src/cmd.lua;
    # }
    include /massbit/massbitroute/app/src/sites/services/gateway/etc/_test_server.conf;
}

# configuration file /massbit/massbitroute/app/src/sites/services/gateway/etc/_ssl_gw.mbr.massbitroute.conf:
#__ENV_GATEWAY_DOMAIN_SSL__

# configuration file /massbit/massbitroute/app/src/sites/services/gateway/etc/_vts_server.conf:
# auth_basic 'MBR admin';
# auth_basic_user_file /massbit/massbitroute/app/src/sites/services/node/etc/htpasswd;
vhost_traffic_status_bypass_limit on;
vhost_traffic_status_bypass_stats on;
vhost_traffic_status_display;
vhost_traffic_status_display_format html;

# configuration file /massbit/massbitroute/app/src/sites/services/gateway/etc/_test_server.conf:
location /_test_350k {
    default_type application/json;
    content_by_lua_file /massbit/massbitroute/app/src/sites/services/gateway/src/_test_350k.lua;
}
location /_test_20k {
    default_type application/json;
    content_by_lua_file /massbit/massbitroute/app/src/sites/services/gateway/src/_test_20k.lua;
}
location ~ /_nodeip/([^/]+)/(.*) {
    # access_log /massbit/massbitroute/app/src/sites/services/gateway/logs/_nodeip-access.log;
    # error_log /massbit/massbitroute/app/src/sites/services/gateway/logs/_nodeip-error.log debug;
    #    rewrite /_node/([^/]+)/(.*) /$2 break;
    include /massbit/massbitroute/app/src/sites/services/gateway/etc/_provider_server.conf;
    default_type application/json;
    proxy_pass https://$1/$2;
}
location ~ /_node/([^/]+)/(.*) {
    # access_log /massbit/massbitroute/app/src/sites/services/gateway/logs/_node-access.log;
    # error_log /massbit/massbitroute/app/src/sites/services/gateway/logs/_node-error.log debug;
    #    rewrite /_node/([^/]+)/(.*) /$2 break;
    include /massbit/massbitroute/app/src/sites/services/gateway/etc/_provider_server.conf;
    default_type application/json;
    proxy_pass http://unix:/tmp/$1.sock:/$2;
}
location /nginx_status {
    # Turn on nginx stats
    stub_status on;
    # I do not need logs for stats
    access_log off;
    # Only allow access from Nagios Monitoring server
    allow 127.0.0.1;
    # Deny the rest of the connections
    deny all;
}

# configuration file /massbit/massbitroute/app/src/sites/services/gateway/etc/_provider_server.conf:
proxy_redirect off;
proxy_ssl_verify off;
proxy_ssl_server_name on;
proxy_http_version 1.1;
proxy_set_header Upgrade $http_upgrade;
proxy_set_header Connection $connection_upgrade;

# configuration file /massbit/massbitroute/app/src/sites/services/gateway/sites/../http.d/dapi-eth-mainnet.conf:
server {
    listen unix:/tmp/pUfv5BMgNJ7_l7NV707vmw-0-5f79b557-5f45-4882-88a9-ea0db16cf81e.sock;
    location / {

        proxy_pass http://eth-mainnet-AS-VN.node.mbr.massbitroute.net;
  include /massbit/massbitroute/app/src/sites/services/gateway/etc/_cache_ttl.conf;
  include /massbit/massbitroute/app/src/sites/services/gateway/etc/_proxy_server.conf;
  include /massbit/massbitroute/app/src/sites/services/gateway/etc/_provider_server.conf;
    }
}
server {
    listen unix:/tmp/pUfv5BMgNJ7_l7NV707vmw-0-5f79b557-5f45-4882-88a9-ea0db16cf81e_ws.sock;
    location / {

        proxy_pass http://ws-eth-mainnet-AS-VN.node.mbr.massbitroute.net;
  include /massbit/massbitroute/app/src/sites/services/gateway/etc/_cache_ttl.conf;
  include /massbit/massbitroute/app/src/sites/services/gateway/etc/_proxy_server_ws.conf;
  include /massbit/massbitroute/app/src/sites/services/gateway/etc/_provider_server_ws.conf;
    }
}

server {
    listen unix:/tmp/pUfv5BMgNJ7_l7NV707vmw-0-5bace960-bc28-42ed-8fd5-29b4dd76a723.sock;
    location / {

        proxy_pass http://eth-mainnet-AS-VN.node.mbr.massbitroute.net;
  include /massbit/massbitroute/app/src/sites/services/gateway/etc/_cache_ttl.conf;
  include /massbit/massbitroute/app/src/sites/services/gateway/etc/_proxy_server.conf;
  include /massbit/massbitroute/app/src/sites/services/gateway/etc/_provider_server.conf;
    }
}
server {
    listen unix:/tmp/pUfv5BMgNJ7_l7NV707vmw-0-5bace960-bc28-42ed-8fd5-29b4dd76a723_ws.sock;
    location / {

        proxy_pass http://ws-eth-mainnet-AS-VN.node.mbr.massbitroute.net;
  include /massbit/massbitroute/app/src/sites/services/gateway/etc/_cache_ttl.conf;
  include /massbit/massbitroute/app/src/sites/services/gateway/etc/_proxy_server_ws.conf;
  include /massbit/massbitroute/app/src/sites/services/gateway/etc/_provider_server_ws.conf;
    }
}

upstream upstream_pUfv5BMgNJ7_l7NV707vmw {
    server unix:/tmp/pUfv5BMgNJ7_l7NV707vmw-0-5f79b557-5f45-4882-88a9-ea0db16cf81e.sock max_fails=1 fail_timeout=3s ;server unix:/tmp/pUfv5BMgNJ7_l7NV707vmw-0-5bace960-bc28-42ed-8fd5-29b4dd76a723.sock max_fails=1 fail_timeout=3s weight=1;
    include /massbit/massbitroute/app/src/sites/services/gateway/etc/_upstream_server.conf;
}
upstream upstream_ws_pUfv5BMgNJ7_l7NV707vmw {
    server unix:/tmp/pUfv5BMgNJ7_l7NV707vmw-0-5f79b557-5f45-4882-88a9-ea0db16cf81e_ws.sock max_fails=1 fail_timeout=3s ;server unix:/tmp/pUfv5BMgNJ7_l7NV707vmw-0-5bace960-bc28-42ed-8fd5-29b4dd76a723_ws.sock max_fails=1 fail_timeout=3s weight=1;
    include /massbit/massbitroute/app/src/sites/services/gateway/etc/_upstream_server_ws.conf;
}


server {
    include /massbit/massbitroute/app/src/sites/services/gateway/etc/_pre_server.conf;
    include /massbit/massbitroute/app/src/sites/services/gateway/etc/_ssl_eth-mainnet.massbitroute.net.conf;
    server_name ~^(?<myid>974d0c79-7cef-4c57-859c-3f2eafd883d0)(?<mydomain>.+)$;
    include /massbit/massbitroute/app/src/sites/services/gateway/etc/_session.conf;
    include /massbit/massbitroute/app/src/sites/services/gateway/etc/_location_server.conf;

   set $api_key pUfv5BMgNJ7_l7NV707vmw;
    location /pUfv5BMgNJ7_l7NV707vmw {
        set $mbr_token pUfv5BMgNJ7_l7NV707vmw;

        set $jsonrpc_whitelist '';

        vhost_traffic_status_filter_by_set_key $api_method user::b1cf032d-5971-410a-90fe-9c454a4173f0::project::::api::974d0c79-7cef-4c57-859c-3f2eafd883d0::user_gateway::b1cf032d-5971-410a-90fe-9c454a4173f0::gateway::f242af13-a0b2-4da5-884f-f236838099ee::v1::api_method;

        add_header X-Mbr-User-Id b1cf032d-5971-410a-90fe-9c454a4173f0;
        add_header X-Mbr-Api-Id 974d0c79-7cef-4c57-859c-3f2eafd883d0;
        add_header X-Mbr-Gateway-Id f242af13-a0b2-4da5-884f-f236838099ee;
        proxy_pass http://upstream_pUfv5BMgNJ7_l7NV707vmw/;
        include /massbit/massbitroute/app/src/sites/services/gateway/etc/_node_server.conf;
    }
        location /pUfv5BMgNJ7_l7NV707vmw/_redirect {
    include /massbit/massbitroute/app/src/sites/services/gateway/etc/_api_redirect.conf;
        }
        location /pUfv5BMgNJ7_l7NV707vmw/_getlink {
    include /massbit/massbitroute/app/src/sites/services/gateway/etc/_api_getlink.conf;
        }
}
server {
    include /massbit/massbitroute/app/src/sites/services/gateway/etc/_pre_server_ws.conf;
    include /massbit/massbitroute/app/src/sites/services/gateway/etc/_ssl_eth-mainnet.massbitroute.net.conf;
    server_name ws-~^(?<myid>974d0c79-7cef-4c57-859c-3f2eafd883d0)(?<mydomain>.+)$;
    include /massbit/massbitroute/app/src/sites/services/gateway/etc/_session_ws.conf;
    include /massbit/massbitroute/app/src/sites/services/gateway/etc/_location_server.conf;

    location /pUfv5BMgNJ7_l7NV707vmw {
        set $mbr_token pUfv5BMgNJ7_l7NV707vmw;

        set $jsonrpc_whitelist '';

        vhost_traffic_status_filter_by_set_key $api_method user::b1cf032d-5971-410a-90fe-9c454a4173f0::api::974d0c79-7cef-4c57-859c-3f2eafd883d0::user_gateway::b1cf032d-5971-410a-90fe-9c454a4173f0::gateway::f242af13-a0b2-4da5-884f-f236838099ee::v1::api_method;

        add_header X-Mbr-User-Id b1cf032d-5971-410a-90fe-9c454a4173f0;
        add_header X-Mbr-Api-Id 974d0c79-7cef-4c57-859c-3f2eafd883d0;
        add_header X-Mbr-Gateway-Id f242af13-a0b2-4da5-884f-f236838099ee;
        proxy_pass http://upstream_ws_pUfv5BMgNJ7_l7NV707vmw/;
        include /massbit/massbitroute/app/src/sites/services/gateway/etc/_node_server_ws.conf;
    }

}

# configuration file /massbit/massbitroute/app/src/sites/services/gateway/etc/_cache_ttl.conf:
set $api_method '';
set $api_method_ttl 0;
access_by_lua_file /massbit/massbitroute/app/src/sites/services/gateway/src/jsonrpc-access.lua;
add_header X-Accel-Expires $api_method_ttl;
# configuration file /massbit/massbitroute/app/src/sites/services/gateway/etc/_proxy_server.conf:
proxy_cache_use_stale updating error timeout non_idempotent http_429 http_500 http_502 http_503 http_504;
proxy_next_upstream error timeout non_idempotent http_429 http_500 http_502 http_503 http_504;
proxy_connect_timeout 30;
proxy_send_timeout 30;
proxy_read_timeout 30;
send_timeout 30;

# configuration file /massbit/massbitroute/app/src/sites/services/gateway/etc/_proxy_server_ws.conf:
proxy_cache_use_stale updating error timeout non_idempotent http_429 http_500 http_502 http_503 http_504;
proxy_next_upstream error timeout non_idempotent http_429 http_500 http_502 http_503 http_504;
# proxy_connect_timeout 30;
# proxy_send_timeout 30;
proxy_read_timeout 7d;
# send_timeout 30;

# configuration file /massbit/massbitroute/app/src/sites/services/gateway/etc/_provider_server_ws.conf:
proxy_redirect off;
proxy_ssl_verify off;
proxy_ssl_server_name on;
proxy_http_version 1.1;
proxy_set_header Upgrade $http_upgrade;
proxy_set_header Connection $connection_upgrade;

# configuration file /massbit/massbitroute/app/src/sites/services/gateway/etc/_upstream_server.conf:
keepalive 100;

# configuration file /massbit/massbitroute/app/src/sites/services/gateway/etc/_upstream_server_ws.conf:
keepalive 100;

# configuration file /massbit/massbitroute/app/src/sites/services/gateway/etc/_pre_server.conf:
listen 80;
listen 443 ssl;
resolver 8.8.4.4 ipv6=off;
client_body_buffer_size 512K;
client_max_body_size 1G;
set $api_method '';
set $jsonrpc_whitelist '';
location /ping {
    return 200 pong;
}

# configuration file /massbit/massbitroute/app/src/sites/services/gateway/etc/_ssl_eth-mainnet.massbitroute.net.conf:
ssl_certificate /massbit/massbitroute/app/src/sites/services/gateway/ssl/live/eth-mainnet.massbitroute.net/fullchain.pem;
ssl_certificate_key /massbit/massbitroute/app/src/sites/services/gateway/ssl/live/eth-mainnet.massbitroute.net/privkey.pem;

# configuration file /massbit/massbitroute/app/src/sites/services/gateway/etc/_session.conf:
encrypted_session_key abcdefghijmbrbaysaklmnopqrstuvwo;
encrypted_session_iv 123mbrbaysao4567;
encrypted_session_expires 30d;

# configuration file /massbit/massbitroute/app/src/sites/services/gateway/etc/_location_server.conf:
access_log /massbit/massbitroute/app/src/sites/services/gateway/logs/access/$host.log main_json;
include /massbit/massbitroute/app/src/sites/services/gateway/etc/_test_server.conf;

lua_need_request_body on;
set $resp_body "";
body_filter_by_lua_file /massbit/massbitroute/app/src/sites/services/gateway/src/filter-jsonrpc-body.lua;
# configuration file /massbit/massbitroute/app/src/sites/services/gateway/etc/_node_server.conf:
rewrite /(.*) / break;
set $resp_body "";
body_filter_by_lua_file /massbit/massbitroute/app/src/sites/services/gateway/src/filter-jsonrpc-body.lua;
access_by_lua_file /massbit/massbitroute/app/src/sites/services/gateway/src/filter-jsonrpc-access.lua;
include /massbit/massbitroute/app/src/sites/services/gateway/etc/_proxy_server.conf;
include /massbit/massbitroute/app/src/sites/services/gateway/etc/_provider_server.conf;
include /massbit/massbitroute/app/src/sites/services/gateway/etc/_cache_server.conf;
add_header X-Accel-Expires $upstream_http_x_accel_expires;

# configuration file /massbit/massbitroute/app/src/sites/services/gateway/etc/_cache_server.conf:
proxy_cache_methods GET HEAD POST;
proxy_cache_key $request_uri|$request_body;
proxy_cache_min_uses 1;
# proxy_cache cache_gateway;
proxy_cache_valid 200 3s;
proxy_cache_background_update on;
proxy_cache_lock on;
proxy_cache_revalidate on;
add_header X-Mbr-Cached $upstream_cache_status;

# configuration file /massbit/massbitroute/app/src/sites/services/gateway/etc/_api_redirect.conf:
return 308 $scheme://$myid-$continent_code-$country_code$mydomain/$api_key$is_args$args;

# configuration file /massbit/massbitroute/app/src/sites/services/gateway/etc/_api_getlink.conf:
return 200 '{"url":"$scheme://$myid-$continent_code-$country_code$mydomain/$api_key$is_args$args"}';

# configuration file /massbit/massbitroute/app/src/sites/services/gateway/etc/_pre_server_ws.conf:
listen 80;
listen 443 ssl;
resolver 8.8.4.4 ipv6=off;
client_body_buffer_size 512K;
client_max_body_size 1G;
set $api_method '';
set $jsonrpc_whitelist '';
location /ping {
    return 200 pong;
}

# configuration file /massbit/massbitroute/app/src/sites/services/gateway/etc/_session_ws.conf:
encrypted_session_key abcdefghijmbrbaysaklmnopqrstuvwo;
encrypted_session_iv 123mbrbaysao4567;
encrypted_session_expires 30d;

# configuration file /massbit/massbitroute/app/src/sites/services/gateway/etc/_node_server_ws.conf:
rewrite /(.*) / break;
access_by_lua_file /massbit/massbitroute/app/src/sites/services/gateway/src/filter-jsonrpc-access_ws.lua;
include /massbit/massbitroute/app/src/sites/services/gateway/etc/_proxy_server_ws.conf;
include /massbit/massbitroute/app/src/sites/services/gateway/etc/_provider_server_ws.conf;
include /massbit/massbitroute/app/src/sites/services/gateway/etc/_cache_server_ws.conf;

# configuration file /massbit/massbitroute/app/src/sites/services/gateway/etc/_cache_server_ws.conf:
proxy_cache_methods GET HEAD POST;
proxy_cache_key $request_uri|$request_body;
proxy_cache_min_uses 1;
# proxy_cache cache_gateway;
proxy_cache_valid 200 3s;
proxy_cache_background_update on;
proxy_cache_lock on;
proxy_cache_revalidate on;
add_header X-Mbr-Cached $upstream_cache_status;

# configuration file /massbit/massbitroute/app/src/sites/services/gateway/sites/../http.d/gw-eth-mainnet-nodes.conf:
server {
    listen unix:/tmp/e7d35e02-190d-49bf-8d5f-b4e3b048305e-ws.sock;
    location / {
               set $api_method '';
               set $api_method_ttl 0;
               access_by_lua_file /massbit/massbitroute/app/src/sites/services/gateway/src/jsonrpc-access.lua;
               vhost_traffic_status_filter_by_set_key $api_method e7d35e02-190d-49bf-8d5f-b4e3b048305e::api_method;
               add_header X-Accel-Expires $api_method_ttl;
        proxy_set_header X-Api-Key NRE4geIsrjcWh3GKD4DJiw;
        proxy_set_header Host ws-e7d35e02-190d-49bf-8d5f-b4e3b048305e.node.mbr.massbitroute.net;
        proxy_pass http://127.0.0.1;


  include /massbit/massbitroute/app/src/sites/services/gateway/etc/_provider_server_ws.conf;
    }
}
server {
    listen unix:/tmp/e7d35e02-190d-49bf-8d5f-b4e3b048305e.sock;
    location / {
               set $api_method '';
               set $api_method_ttl 0;
               access_by_lua_file /massbit/massbitroute/app/src/sites/services/gateway/src/jsonrpc-access.lua;
               vhost_traffic_status_filter_by_set_key $api_method e7d35e02-190d-49bf-8d5f-b4e3b048305e::api_method;
               add_header X-Accel-Expires $api_method_ttl;
        proxy_set_header X-Api-Key NRE4geIsrjcWh3GKD4DJiw;
        proxy_set_header Host e7d35e02-190d-49bf-8d5f-b4e3b048305e.node.mbr.massbitroute.net;
        #proxy_pass https://mainnet.infura.io/v3/ada4a958376749a9bbd6abc0fc5f404b;
        #proxy_pass https://44.197.86.233;
        proxy_pass http://127.0.0.1;

  include /massbit/massbitroute/app/src/sites/services/gateway/etc/_provider_server.conf;
    }
}

# configuration file /massbit/massbitroute/app/src/sites/services/gateway/sites/../http.d/gw-eth-mainnet-nodesources.conf:
server {
listen 80;
client_body_buffer_size 512K;
client_max_body_size 1G;
set $api_method '';
set $jsonrpc_whitelist '';
    server_name e7d35e02-190d-49bf-8d5f-b4e3b048305e.node.mbr.massbitroute.net;
    location / {
        access_by_lua_file /massbit/massbitroute/app/src/sites/services/gateway/src/node-jsonrpc-access.lua;
        add_header X-Mbr-Node-Id e7d35e02-190d-49bf-8d5f-b4e3b048305e;
        vhost_traffic_status_filter_by_set_key $api_method user::b1cf032d-5971-410a-90fe-9c454a4173f0::node::e7d35e02-190d-49bf-8d5f-b4e3b048305e::v1::api_method;
        proxy_pass https://mainnet.infura.io/v3/ada4a958376749a9bbd6abc0fc5f404b;

    }
}

# configuration file /massbit/massbitroute/app/src/sites/services/gateway/sites/../http.d/gw-eth-mainnet-upstreams.conf:
 server {
     listen unix:/tmp/eth-mainnet-getblock-1.sock;
     location / {
         add_header X-Mbr-Node-Id eth-mainnet-getblock-1;
         proxy_set_header X-Api-Key 6c4ddad0-7646-403e-9c10-744f91d37ccf;
         proxy_pass https://eth.getblock.io/mainnet/;
   include /massbit/massbitroute/app/src/sites/services/gateway/etc/_provider_server.conf;
     }
 }
upstream eth-mainnet.node.mbr.massbitroute.net {
include  /massbit/massbitroute/app/src/sites/services/gateway/http.d/eth-mainnet.upstream;
  server  unix:/tmp/eth-mainnet-getblock-1.sock  backup;
    include /massbit/massbitroute/app/src/sites/services/gateway/etc/_upstream_server.conf;
}
server {
    listen unix:/tmp/eth-mainnet.node.mbr.massbitroute.net.sock;
    location / {
        proxy_pass http://eth-mainnet.node.mbr.massbitroute.net;

  include /massbit/massbitroute/app/src/sites/services/gateway/etc/_provider_server.conf;
    }
}
 server {
     listen unix:/tmp/eth-mainnet-getblock-ws-1.sock;
     location / {
         add_header X-Mbr-Node-Id eth-mainnet-getblock-1;
         proxy_set_header X-Api-Key 6c4ddad0-7646-403e-9c10-744f91d37ccf;
         proxy_pass https://eth.getblock.io/mainnet/;
   include /massbit/massbitroute/app/src/sites/services/gateway/etc/_provider_server_ws.conf;
     }
 }
upstream ws-eth-mainnet.node.mbr.massbitroute.net {
include  /massbit/massbitroute/app/src/sites/services/gateway/http.d/ws-eth-mainnet.upstream;
  server  unix:/tmp/eth-mainnet-getblock-ws-1.sock  backup;
    include /massbit/massbitroute/app/src/sites/services/gateway/etc/_upstream_server_ws.conf;

}
server {
    listen unix:/tmp/ws-eth-mainnet.node.mbr.massbitroute.net.sock;
    location / {
        proxy_pass http://ws-eth-mainnet.node.mbr.massbitroute.net;

  include /massbit/massbitroute/app/src/sites/services/gateway/etc/_provider_server_ws.conf;
    }
}


upstream eth-mainnet-AS.node.mbr.massbitroute.net {
include  /massbit/massbitroute/app/src/sites/services/gateway/http.d/eth-mainnet-AS.upstream;
  server unix:/tmp/eth-mainnet.node.mbr.massbitroute.net.sock  backup;
    include /massbit/massbitroute/app/src/sites/services/gateway/etc/_upstream_server.conf;
}
server {
    listen unix:/tmp/eth-mainnet-AS.node.mbr.massbitroute.net.sock;
    location / {
        proxy_pass http://eth-mainnet-AS.node.mbr.massbitroute.net;

  include /massbit/massbitroute/app/src/sites/services/gateway/etc/_provider_server.conf;
    }
}
upstream ws-eth-mainnet-AS.node.mbr.massbitroute.net {
include  /massbit/massbitroute/app/src/sites/services/gateway/http.d/ws-eth-mainnet-AS.upstream;
  server unix:/tmp/ws-eth-mainnet.node.mbr.massbitroute.net.sock  backup;
    include /massbit/massbitroute/app/src/sites/services/gateway/etc/_upstream_server_ws.conf;

}
server {
    listen unix:/tmp/ws-eth-mainnet-AS.node.mbr.massbitroute.net.sock;
    location / {
        proxy_pass http://ws-eth-mainnet-AS.node.mbr.massbitroute.net;

  include /massbit/massbitroute/app/src/sites/services/gateway/etc/_provider_server_ws.conf;
    }
}


upstream eth-mainnet-AS-VN-v1.node.mbr.massbitroute.net {
include  /massbit/massbitroute/app/src/sites/services/gateway/http.d/eth-mainnet-AS-VN-v1.upstream;
  server  unix:/tmp/eth-mainnet-getblock-1.sock ;
    include /massbit/massbitroute/app/src/sites/services/gateway/etc/_upstream_server.conf;
}
server {
    listen unix:/tmp/eth-mainnet-AS-VN-v1.node.mbr.massbitroute.net.sock;
    location / {
        proxy_pass http://eth-mainnet-AS-VN-v1.node.mbr.massbitroute.net;

  include /massbit/massbitroute/app/src/sites/services/gateway/etc/_provider_server.conf;
    }
}
upstream ws-eth-mainnet-AS-VN-v1.node.mbr.massbitroute.net {
include  /massbit/massbitroute/app/src/sites/services/gateway/http.d/ws-eth-mainnet-AS-VN-v1.upstream;
  server  unix:/tmp/eth-mainnet-getblock-ws-1.sock ;
    include /massbit/massbitroute/app/src/sites/services/gateway/etc/_upstream_server_ws.conf;

}
server {
    listen unix:/tmp/ws-eth-mainnet-AS-VN-v1.node.mbr.massbitroute.net.sock;
    location / {
        proxy_pass http://ws-eth-mainnet-AS-VN-v1.node.mbr.massbitroute.net;

  include /massbit/massbitroute/app/src/sites/services/gateway/etc/_provider_server_ws.conf;
    }
}


upstream eth-mainnet-AS-VN-v1-v2.node.mbr.massbitroute.net {
include  /massbit/massbitroute/app/src/sites/services/gateway/http.d/eth-mainnet-AS-VN-v1-v2.upstream;
  server unix:/tmp/eth-mainnet-AS-VN-v1.node.mbr.massbitroute.net.sock ;
    include /massbit/massbitroute/app/src/sites/services/gateway/etc/_upstream_server.conf;
}
server {
    listen unix:/tmp/eth-mainnet-AS-VN-v1-v2.node.mbr.massbitroute.net.sock;
    location / {
        proxy_pass http://eth-mainnet-AS-VN-v1-v2.node.mbr.massbitroute.net;

  include /massbit/massbitroute/app/src/sites/services/gateway/etc/_provider_server.conf;
    }
}
upstream ws-eth-mainnet-AS-VN-v1-v2.node.mbr.massbitroute.net {
include  /massbit/massbitroute/app/src/sites/services/gateway/http.d/ws-eth-mainnet-AS-VN-v1-v2.upstream;
  server unix:/tmp/ws-eth-mainnet-AS-VN-v1.node.mbr.massbitroute.net.sock ;
    include /massbit/massbitroute/app/src/sites/services/gateway/etc/_upstream_server_ws.conf;

}
server {
    listen unix:/tmp/ws-eth-mainnet-AS-VN-v1-v2.node.mbr.massbitroute.net.sock;
    location / {
        proxy_pass http://ws-eth-mainnet-AS-VN-v1-v2.node.mbr.massbitroute.net;

  include /massbit/massbitroute/app/src/sites/services/gateway/etc/_provider_server_ws.conf;
    }
}


upstream eth-mainnet-AS-VN.node.mbr.massbitroute.net {
include  /massbit/massbitroute/app/src/sites/services/gateway/http.d/eth-mainnet-AS-VN.upstream;
  server unix:/tmp/eth-mainnet-AS-VN-v1-v2.node.mbr.massbitroute.net.sock  backup;
    include /massbit/massbitroute/app/src/sites/services/gateway/etc/_upstream_server.conf;
}
server {
    listen unix:/tmp/eth-mainnet-AS-VN.node.mbr.massbitroute.net.sock;
    location / {
        proxy_pass http://eth-mainnet-AS-VN.node.mbr.massbitroute.net;

  include /massbit/massbitroute/app/src/sites/services/gateway/etc/_provider_server.conf;
    }
}
upstream ws-eth-mainnet-AS-VN.node.mbr.massbitroute.net {
include  /massbit/massbitroute/app/src/sites/services/gateway/http.d/ws-eth-mainnet-AS-VN.upstream;
  server unix:/tmp/eth-mainnet-AS-VN-v1-v2-ws.node.mbr.massbitroute.net.sock  backup;
    include /massbit/massbitroute/app/src/sites/services/gateway/etc/_upstream_server_ws.conf;

}
server {
    listen unix:/tmp/ws-eth-mainnet-AS-VN.node.mbr.massbitroute.net.sock;
    location / {
        proxy_pass http://ws-eth-mainnet-AS-VN.node.mbr.massbitroute.net;

  include /massbit/massbitroute/app/src/sites/services/gateway/etc/_provider_server_ws.conf;
    }
}



# configuration file /massbit/massbitroute/app/src/sites/services/gateway/http.d/eth-mainnet.upstream:
server unix:/tmp/e7d35e02-190d-49bf-8d5f-b4e3b048305e.sock max_fails=1 fail_timeout=3s;

# configuration file /massbit/massbitroute/app/src/sites/services/gateway/http.d/ws-eth-mainnet.upstream:
server unix:/tmp/e7d35e02-190d-49bf-8d5f-b4e3b048305e-ws.sock max_fails=1 fail_timeout=3s;

# configuration file /massbit/massbitroute/app/src/sites/services/gateway/http.d/eth-mainnet-AS.upstream:
server unix:/tmp/e7d35e02-190d-49bf-8d5f-b4e3b048305e.sock max_fails=1 fail_timeout=3s;

# configuration file /massbit/massbitroute/app/src/sites/services/gateway/http.d/ws-eth-mainnet-AS.upstream:
server unix:/tmp/e7d35e02-190d-49bf-8d5f-b4e3b048305e-ws.sock max_fails=1 fail_timeout=3s;

# configuration file /massbit/massbitroute/app/src/sites/services/gateway/http.d/eth-mainnet-AS-VN-v1.upstream:

# configuration file /massbit/massbitroute/app/src/sites/services/gateway/http.d/ws-eth-mainnet-AS-VN-v1.upstream:

# configuration file /massbit/massbitroute/app/src/sites/services/gateway/http.d/eth-mainnet-AS-VN-v1-v2.upstream:

# configuration file /massbit/massbitroute/app/src/sites/services/gateway/http.d/ws-eth-mainnet-AS-VN-v1-v2.upstream:

# configuration file /massbit/massbitroute/app/src/sites/services/gateway/http.d/eth-mainnet-AS-VN.upstream:
server unix:/tmp/e7d35e02-190d-49bf-8d5f-b4e3b048305e.sock max_fails=1 fail_timeout=3s;

# configuration file /massbit/massbitroute/app/src/sites/services/gateway/http.d/ws-eth-mainnet-AS-VN.upstream:
server unix:/tmp/e7d35e02-190d-49bf-8d5f-b4e3b048305e-ws.sock max_fails=1 fail_timeout=3s;

# configuration file /massbit/massbitroute/app/src/sites/services/gateway/sites/../http.d/gateway.conf9:
# server {
#     listen 80;
#     listen 443 ssl;
#     ssl_certificate /massbit/massbitroute/app/src/sites/services/gateway/ssl/live/eth-mainnet.massbitroute.net/fullchain.pem;
#     ssl_certificate_key /massbit/massbitroute/app/src/sites/services/gateway/ssl/live/eth-mainnet.massbitroute.net/privkey.pem;
#     server_name eth-mainnet.massbitroute.net;
#     location / {
#         proxy_redirect off;
#         proxy_ssl_server_name on;
#         proxy_next_upstream error timeout non_idempotent http_500 http_502 http_503 http_504;
#         proxy_connect_timeout 3;
#         proxy_send_timeout 3;
#         proxy_read_timeout 3;
#         send_timeout 3;
#         proxy_pass http://eth-mainnet.node.mbr.massbitroute.net;
#         proxy_ssl_verify off;
#         proxy_http_version 1.1;
#         proxy_set_header Upgrade $http_upgrade;
#         proxy_set_header Connection $connection_upgrade;
#     }
# }
server {
    listen 80;
    include /massbit/massbitroute/app/src/sites/services/gateway/etc/_ssl_gw.mbr.massbitroute.conf;
    server_name f242af13-a0b2-4da5-884f-f236838099ee.gw.mbr.massbitroute.net gw.mbr.massbitroute.net;
    location /_rtt {
        echo $tcpinfo_rtt;
    }
    location /ping {
        return 200 pong;
    }
    location /__log {
        autoindex on;
        alias /massbit/massbitroute/app/src/sites/services/gateway/logs;
    }
    location /__conf {
        autoindex on;
        alias /massbit/massbitroute/app/src/sites/services/gateway/http.d;
    }
    location /__internal_status_vhost/ {
        access_log /massbit/massbitroute/app/src/sites/services/gateway/logs/stat-f242af13-a0b2-4da5-884f-f236838099ee-access.log main_json;
        error_log /massbit/massbitroute/app/src/sites/services/gateway/logs/stat-f242af13-a0b2-4da5-884f-f236838099ee-error.log debug;
        include /massbit/massbitroute/app/src/sites/services/gateway/etc/_vts_server.conf;
    }
    location /__worker/ {
        proxy_pass http://127.0.0.1:4040/;
    }
    # location / {
    #     proxy_pass http://eth-mainnet.node.mbr.massbitroute.net;
    #     include /massbit/massbitroute/app/src/sites/services/gateway/etc/_proxy_server.conf;
    #     include /massbit/massbitroute/app/src/sites/services/gateway/etc/_provider_server.conf;
    #     include /massbit/massbitroute/app/src/sites/services/gateway/etc/_cache_server.conf;
    # }
    include /massbit/massbitroute/app/src/sites/services/gateway/etc/_test_server.conf;
}

# configuration file /massbit/massbitroute/app/src/sites/services/gateway/tmp/site_stream_gateway.conf: